<!doctype html>
<html>
  <head>
    <title>Getting Started Extension's Popup</title>
    <style>
      body {
        min-width: 357px;
        overflow-x: hidden;
      }

      img {
        margin: 5px;
        border: 2px solid black;
        vertical-align: middle;
        width: 75px;
        height: 75px;
      }
    </style>

    <!--
      - JavaScript and HTML must be in separate files: see our Content Security
      - Policy documentation[1] for details and explanation.
      -
      - [1]: http://developer.chrome.com/extensions/contentSecurityPolicy.html
     -->
    <!-- Load c3.css -->
  <link href="c3.min.css" rel="stylesheet" type="text/css">

    <!-- Load d3.js and c3.js -->
  <script src="c3.min.js"></script>

  <script src="d3.min.js" charset="utf-8"></script>
  <script src="nv.d3.min.js" charset="utf-8"></script>
  <link rel="stylesheet" type="text/css" href="nv.d3.min.css">
  <script>
    // TODO: dynamically change start/pause
    stats = {};
    timer = null;

    function startTimer() {
        if (!timer) {
            start = Date.now();
            timer = setInterval(update, 100);
        } else {
            timer = setInterval(update, 100);
        }
    }

    function stopTimer() {
        if (timer) {
            clearInterval(timer);
            // timer = null;
        }
    }

    function resetTimer() {
        start = 0;
        timer = null;
        render();
    }

    function update() {
        now = Date.now();
        runningTime = (now - start)/1000
        render();
    }
    function render() {
        task = document.getElementById("task").value;
        runningTaskDisplay = document.getElementById("runningTask");
        runningTaskDisplay.innerHTML = task + " " + runningTime + " seconds";
        stats[task] = runningTime;
        statsArray = arrayFromSet(stats);
        // change(statsArray);
        updatec3(statsArray);
    }
    function arrayFromSet(set) {
        var a = new Array();
        console.log("set to convert: ", set);
        for (var key in set) {
            console.log("Add key: ", key);
            // a.push({"key":key, "value":set[key]});
            a.push([key, set[key]]);
        }
        return a;
    }
  </script>

  </head>
  <body>
    Hello World!
    <div id=".stopwatch">
        <input id='task' type="text" name="task"></input>
        <button type="button" onclick="startTimer()">Start</button>
        <button type="button" onclick="stopTimer()">Pause</button>
        <button type="button" onclick="resetTimer()">Reset</button>
    </div>
    <div id="display">
        <div id="runningTask"></div>
        <div id="finishedTasks"></div>
        <div id="c3sample"></div>
        <div id="tasksChart"></div>
    </div>





    <script>

var data1 = [{
    "key": "mip",
    "value": 24
}, {
    "key": "theft",
    "value": 558
}, {
    "key": "drugs",
    "value": 81
}, {
    "key": "arson",
    "value": 3
}, {
    "key": "assault",
    "value": 80
}, {
    "key": "burglary",
    "value": 49
}, {
    "key": "disorderlyConduct",
    "value": 63
}, {
    "key": "mischief",
    "value": 189
}, {
    "key": "dui",
    "value": 107
}, {
    "key": "resistingArrest",
    "value": 11
}, {
    "key": "sexCrimes",
    "value": 24
}, {
    "key": "other",
    "value": 58
}];

var chart = c3.generate({
    bindto: '#c3sample',
    data: {
        columns: [],
        type : 'donut',
        onclick: function (d, i) { console.log("onclick", d, i); },
        onmouseover: function (d, i) { console.log("onmouseover", d, i); },
        onmouseout: function (d, i) { console.log("onmouseout", d, i); }
    },
    donut: {
        title: "Task Stats"
    }
});

function updatec3(data) {
    console.log("Update c3", data);
    chart.load({
        columns: data
    });
}

var data2 = [{
    "key": "mip",
    "value": 10
}, {
    "key": "theft",
    "value": 30
}, {
    "key": "drugs",
    "value": 10
}, {
    "key": "arson",
    "value": 3
}, {
    "key": "assault",
    "value": 80
}, {
    "key": "burglary",
    "value": 49
}, {
    "key": "disorderlyConduct",
    "value": 10
}, {
    "key": "mischief",
    "value": 389
}, {
    "key": "dui",
    "value": 507
}, {
    "key": "resistingArrest",
    "value": 11
}, {
    "key": "sexCrimes",
    "value": 24
}, {
    "key": "other",
    "value": 258
}];

var width = 800,
    height = 250,
    radius = Math.min(width, height) / 2;

var color = d3.scale.ordinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

var arc = d3.svg.arc()
    .outerRadius(radius - 10)
    .innerRadius(radius - 70);

var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) {
        // return d.totalCrimes;
        return d.value;
    });


var svg = d3.select("#tasksChart").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("id", "pieChart")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var path = svg.selectAll("path")
    .data(pie(data1))
    .enter()
    .append("path");

path.transition()
    .duration(500)
    .attr("fill", function(d, i) {
        return color(d.data.key);
    })
    .attr("d", arc)
    .each(function(d) {
        this._current = d;
    }); // store the initial angles

change(data1);

function change(data) {
    console.log("change", data)
    path.data(pie(data));
    // redraw the arcs
    // path.transition().duration(750).attrTween("d", arcTween) 
    path.transition().attrTween("d", arcTween) 
    .attr("fill", function(d, i) {
        return color(d.data.key);
    });

}

// Store the displayed angles in _current.
// Then, interpolate from _current to the new angles.
// During the transition, _current is updated in-place by d3.interpolate.

function arcTween(a) {
    var i = d3.interpolate(this._current, a);
    this._current = i(0);
    return function(t) {
        return arc(i(t));
    };
}
    </script>
  </body>
</html>

